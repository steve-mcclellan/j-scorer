<div id="topics">
  <h2>
    Topics for <%= @sample ? @email : @user.email %>
    (<%= @user.topics.count %>):
  </h2>

  <table id="topicTable" class="tablesorter">
    <thead>
      <tr>
        <th>Topic</th>
        <th>Categories</th>
        <th>R1Right</th>
        <th>R1Wrong</th>
        <th>R1Pass</th>
        <th>DDRight</th>
        <th>DDWrong</th>
        <th>R2Right</th>
        <th>R2Wrong</th>
        <th>R2Pass</th>
        <th>DDRight</th>
        <th>DDWrong</th>
        <th>Total Score</th>
        <th>Possible Score</th>
        <th>Efficiency</th>
        <th>Finals Right</th>
        <th>Finals Wrong</th>
        <th>Final Success Rate</th>
      </tr>
    </thead>
    <tbody>
      <!-- Universal Topic -->
      <% summary = @user.all_game_summary %>
      <tr>
        <td>--ALL CATEGORIES--</td>
        <td><%= @user.games.count * 13 %></td>
        <td><%= summary[:round_one][:right] %></td>
        <td><%= summary[:round_one][:wrong] %></td>
        <td><%= summary[:round_one][:pass] %></td>
        <td><%= summary[:round_one][:dd_right] %></td>
        <td><%= summary[:round_one][:dd_wrong] %></td>
        <td><%= summary[:round_two][:right] %></td>
        <td><%= summary[:round_two][:wrong] %></td>
        <td><%= summary[:round_two][:pass] %></td>
        <td><%= summary[:round_two][:dd_right] %></td>
        <td><%= summary[:round_two][:dd_wrong] %></td>
        <td><%= ts = summary[:round_one][:score] +
                     summary[:round_two][:score] %></td>
        <td><%= ps = summary[:round_one][:possible_score] +
                     summary[:round_two][:possible_score] %></td>
        <!-- Efficiency -->
        <% if ps.zero? %>
          <td></td>
        <% else %>
          <td>
            <%= number_with_precision((ts / ps.to_f), precision: 5) %>
          </td>
        <% end %>
        <td><%= fr = summary[:finals][:right] %></td>
        <td><%= fw = summary[:finals][:wrong] %></td>
        <!-- Final Success Rate -->
        <% if (fr + fw).zero? %>
          <td></td>
        <% else %>
          <td>
            <%= number_with_precision((fr / (fr + fw).to_f), precision: 5) %>
          </td>
        <% end %>
      </tr>

      <!-- Individual Topics -->
      <% @user.topics.each do |topic| %>
        <% round_one = topic.round_one_stats %>
        <% round_two = topic.round_two_stats %>
        <tr>
          <td><%= topic.name %></td>
          <td><%= topic.sixths.count + topic.finals.count %></td>
          <td><%= round_one[:right] %></td>
          <td><%= round_one[:wrong] %></td>
          <td><%= round_one[:pass] %></td>
          <td><%= round_one[:dd_right] %></td>
          <td><%= round_one[:dd_wrong] %></td>
          <td><%= round_two[:right] %></td>
          <td><%= round_two[:wrong] %></td>
          <td><%= round_two[:pass] %></td>
          <td><%= round_two[:dd_right] %></td>
          <td><%= round_two[:dd_wrong] %></td>
          <td><%= ts = round_one[:score] + round_two[:score] %></td>
          <td><%= ps = round_one[:possible_score] +
                       round_two[:possible_score] %></td>
          <!-- Efficiency -->
          <% if ps.zero? %>
            <td></td>
          <% else %>
            <td>
              <%= number_with_precision((ts / ps.to_f), precision: 5) %>
            </td>
          <% end %>
          <td><%= fr = topic.finals.where(result: 3).count %></td>
          <td><%= fw = topic.finals.where(result: 1).count %></td>
          <!-- Final Success Rate -->
          <% if (fr + fw).zero? %>
            <td></td>
          <% else %>
            <td>
              <%= number_with_precision((fr / (fr + fw).to_f), precision: 5) %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
// Make table sortable.
// Default sort: [ leftmost column, ascending ].
$( "#topicTable" ).tablesorter({
  sortList: [[0,0]]
});

$( "#topicTable" ).stickyTableHeaders({
  scrollableArea: $( '#stats-area' )
});
</script>
